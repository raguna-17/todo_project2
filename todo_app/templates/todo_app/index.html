<!-- index.html -->
{% load static %}
<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <title>Todoアプリ</title>

    <!-- JS の読み込み順に注意 -->
    <script defer src="{% static 'js/auth.js' %}"></script>
    <script defer src="{% static 'js/api.js' %}"></script>
    <script defer src="{% static 'js/tasks.js' %}"></script>
</head>

<body>
    <h1>ToDoアプリ</h1>

    <!-- タスク追加フォーム -->
    <form id="task-form">
        <input type="text" id="title" placeholder="タスク名" required>
        <input type="datetime-local" id="deadline" required>
        <select id="priority">
            <option value="L">Low</option>
            <option value="M" selected>Medium</option>
            <option value="H">High</option>
        </select>
        <button type="submit">追加</button>
    </form>

    <!-- タスク一覧表示 -->
    <h2>タスク一覧</h2>
    <ul id="task-list"></ul>

    <!-- エラー表示 -->
    <div id="error-box" style="color:red; margin:10px 0;"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // アクセストークンが無ければログインページにリダイレクト
            const token = localStorage.getItem('accessToken');
            if (!token) {
                console.warn('アクセストークンがありません。ログインページにリダイレクトします。');
                window.location.href = '{% url "login" %}';
            }
        });
    </script>
</body>

</html>